import json
import unittest
import unittest.mock

from go_space import board_lib, go_types


class BoardTest(unittest.TestCase):
    @unittest.mock.patch("go_space.consts.SIZE", 3)
    def test_sgf_format(self):
        board = board_lib.Board()
        board.place(go_types.Point.fromLabel("aa"), go_types.Player.Black)
        board.place(go_types.Point.fromLabel("ba"), go_types.Player.White)
        board.place(go_types.Point.fromLabel("ac"), go_types.Player.Black)
        self.assertEqual(board.ascii_board(), ("#O.\n" "...\n" "#.."))

    @unittest.mock.patch("go_space.consts.SIZE", 3)
    def test_a1_format(self):
        board = board_lib.Board()
        board.place(go_types.Point.fromLabel("A3"), go_types.Player.Black)
        board.place(go_types.Point.fromLabel("B3"), go_types.Player.White)
        board.place(go_types.Point.fromLabel("A1"), go_types.Player.Black)
        self.assertEqual(board.ascii_board(), ("#O.\n" "...\n" "#.."))

    @unittest.mock.patch("go_space.consts.SIZE", 3)
    def test_json_read(self):
        json_str = '{"black": ["aa", "ac"], "white": ["ba"]}'
        brd = json.loads(json_str)
        self.assertEqual(
            board_lib.boardFromBwBoardStr(brd).ascii_board(), ("#O.\n" "...\n" "#..")
        )

    def test_remove_stones(self):
        board = board_lib.Board()
        board.place(point=go_types.Point(row=1, col=1), player=go_types.Player.White)
        board.place(point=go_types.Point(row=0, col=1), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=2, col=1), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=1, col=0), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=1, col=2), player=go_types.Player.Black)
        self.assertEqual(
            board.ascii_board(),
            """.#.................
               #.#................
               .#.................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................""".replace(
                " ", ""
            ),
        )

    def test_remove_stones_corner(self):
        board = board_lib.Board()
        board.place(point=go_types.Point(row=0, col=0), player=go_types.Player.White)
        board.place(point=go_types.Point(row=1, col=0), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=0, col=1), player=go_types.Player.Black)
        self.assertEqual(
            board.ascii_board(),
            """.#.................
               #..................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................""".replace(
                " ", ""
            ),
        )

    def test_remove_stones_blob(self):
        board = board_lib.Board()
        board.place(point=go_types.Point(row=1, col=1), player=go_types.Player.White)
        board.place(point=go_types.Point(row=1, col=2), player=go_types.Player.White)
        board.place(point=go_types.Point(row=2, col=2), player=go_types.Player.White)
        board.place(point=go_types.Point(row=0, col=1), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=0, col=2), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=0, col=3), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=1, col=0), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=1, col=3), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=2, col=1), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=2, col=3), player=go_types.Player.Black)
        board.place(point=go_types.Point(row=3, col=2), player=go_types.Player.Black)
        self.assertEqual(
            board.ascii_board(),
            """.###...............
               #..#...............
               .#.#...............
               ..#................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................
               ...................""".replace(
                " ", ""
            ),
        )
